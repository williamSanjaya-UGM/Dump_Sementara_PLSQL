CREATE OR REPLACE PROCEDURE CASHIER_CHECK_ABSENT(
    I_INPUT_DATE IN DATE
)AS
CURSOR SELECT_CUR IS
    SELECT EMP_HR.NAME HRN
    FROM CASHIER_POS_RECORD
    JOIN EMP_HR ON EMP_HR.ID=CASHIER_POS_RECORD.CASHIER_ID
    WHERE TRUNC(INPUT_DATE)=TRUNC(TO_DATE(I_INPUT_DATE));
NAMES_T SELECT_CUR%ROWTYPE;
TYPE NAMES_TT IS TABLE OF NAMES_T%TYPE;-- must use type
L_NAMES NAMES_TT;
BEGIN
    OPEN SELECT_CUR;
    FETCH SELECT_CUR BULK COLLECT INTO L_NAMES;
    CLOSE SELECT_CUR;
    FOR INDX IN 1 .. L_NAMES.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE(L_NAMES(INDX).HRN);
    END LOOP;
END;

CREATE OR REPLACE PROCEDURE CASHIER_CHECK_ABSENT_VER2(
    I_INPUT_DATE IN DATE,
    PASSED_CURSOR OUT SYS_REFCURSOR
)AS
BEGIN
    OPEN PASSED_CURSOR FOR 
        SELECT EMP_HR.NAME HRN
        FROM CASHIER_POS_RECORD
        JOIN EMP_HR ON EMP_HR.ID=CASHIER_POS_RECORD.CASHIER_ID
        WHERE TRUNC(INPUT_DATE)=TRUNC(TO_DATE(I_INPUT_DATE));
END;

EXECUTE CASHIER_CHECK_ABSENT('12-MAY-2021');

DECLARE
INPUT_DATE CASHIER_POS_RECORD.INPUT_DATE%TYPE :='12-MAY-2021';
OUT_PASSED_CURSOR SYS_REFCURSOR;
V_HR_NAME EMP_HR.NAME%TYPE;
BEGIN
    CASHIER_CHECK_ABSENT_VER2(INPUT_DATE,OUT_PASSED_CURSOR);
    LOOP
        FETCH OUT_PASSED_CURSOR INTO V_HR_NAME;
        EXIT WHEN OUT_PASSED_CURSOR%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE('DARI BLOCK CODE: '||V_HR_NAME);
    END LOOP;
    CLOSE OUT_PASSED_CURSOR;
END;

CREATE OR REPLACE PROCEDURE DROP_TABLE_IF_EXISTS(TABLE_NAME IN VARCHAR2)AS
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE '||TABLE_NAME;
    EXCEPTION
        WHEN OTHERS THEN
            IF SQLCODE !=-942 THEN
                RAISE;
            END IF;
END;

EXECUTE DROP_TABLE_IF_EXISTS('CUST_MAST_ORDER');

SELECT * FROM FOOD_BEVERAGES_INFO;
SELECT * FROM CUST_MAST_ORDER;
SELECT * FROM CUST_DETAIL_ORDER;
SELECT * FROM REST_MAST_INVENTORY;
SELECT * FROM REST_DETAIL_INVENTORY;
SELECT * FROM REST_DETAIL_INFO;
SELECT * FROM CASHIER_POS_RECORD;
EXECUTE ADD_INVENTORY('MEJA BUNDAR',1,'MEJA MAKAN','BLOCK C','111111');

DELETE FROM REST_MAST_INVENTORY WHERE ID IN(1,2,3,4);

CREATE OR REPLACE TYPE COUNT_PEOPLE_ABSENT AS OBJECT(
    ABSENT_DATE VARCHAR2(20),
    MEMBER FUNCTION COUNT_PEOPLE RETURN NUMERIC
);

CREATE OR REPLACE TYPE COUNT_PEOPLE_ABSENT AS OBJECT(
    ABSENT_DATE VARCHAR2(20),
    CONSTRUCTOR FUNCTION COUNT_PEOPLE_ABSENT(A_DATE VARCHAR2)RETURN SELF AS RESULT,
    MEMBER FUNCTION COUNT_PEOPLE RETURN NUMERIC
);

CREATE OR REPLACE TYPE BODY COUNT_PEOPLE_ABSENT AS
    MEMBER FUNCTION COUNT_PEOPLE RETURN NUMERIC IS
        PEOPLE_COME NUMERIC;
    BEGIN
        SELECT COUNT(*) INTO PEOPLE_COME FROM CASHIER_POS_RECORD
        WHERE TRUNC(INPUT_DATE)=TO_DATE(SELF.ABSENT_DATE);
        
        RETURN PEOPLE_COME;
    END COUNT_PEOPLE;
END;

CREATE OR REPLACE TYPE BODY COUNT_PEOPLE_ABSENT AS
    CONSTRUCTOR FUNCTION COUNT_PEOPLE_ABSENT(A_DATE VARCHAR2)
        RETURN SELF AS RESULT IS
    BEGIN
        SELF.ABSENT_DATE:=A_DATE;
        RETURN;
    END COUNT_PEOPLE_ABSENT;
    MEMBER FUNCTION COUNT_PEOPLE RETURN NUMERIC IS
        PEOPLE_COME NUMERIC;
    BEGIN
        SELECT COUNT(*) INTO PEOPLE_COME FROM CASHIER_POS_RECORD
        WHERE TRUNC(INPUT_DATE)=TO_DATE(SELF.ABSENT_DATE);
        
        RETURN PEOPLE_COME;
    END COUNT_PEOPLE;
END;

CREATE OR REPLACE PROCEDURE TAKE_CASHIER_ABSENT(IN_DATE IN VARCHAR2)
AS
    OBJ_ABSENT COUNT_PEOPLE_ABSENT;
BEGIN
    OBJ_ABSENT:=COUNT_PEOPLE_ABSENT(IN_DATE);
    DBMS_OUTPUT.PUT_LINE('SP: '||OBJ_ABSENT.COUNT_PEOPLE());
END;

CREATE TABLE ABSENT_COUNT OF COUNT_PEOPLE_ABSENT;
DESC COUNT_PEOPLE_ABSENT;
SELECT * FROM ABSENT_COUNT;
DROP TABLE ABSENT_COUNT;

EXECUTE TAKE_CASHIER_ABSENT('12-MAY-2021');

DECLARE
    IN_DATE VARCHAR2(30);
    OBJ_ABSENT COUNT_PEOPLE_ABSENT;
BEGIN
    IN_DATE:='12-MAY-2021';
    OBJ_ABSENT:=COUNT_PEOPLE_ABSENT(IN_DATE);
    DBMS_OUTPUT.PUT_LINE('FROM DECLARE: '||OBJ_ABSENT.COUNT_PEOPLE());
END;
        