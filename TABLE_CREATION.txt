CREATE TABLE EMP_HR(
    ID NUMERIC PRIMARY KEY,
    NIK VARCHAR2(20) UNIQUE,
    NAME VARCHAR2(50) NOT NULL,
    PHONE_NUMBER VARCHAR2(12) NOT NULL,
    ADDRESS VARCHAR2(30) NOT NULL,
    POSITION VARCHAR2(20) NOT NULL,
    JOB_DESC VARCHAR2(100) GENERATED ALWAYS AS(
        CASE 
            WHEN POSITION= 'MANAGER'
                THEN 'RESPONSIBLE WITH INTERNAL AND EXTERNAL BUSINESS, MANAGE THE RESTAURANT'
            WHEN POSITION= 'CASHIER'
                THEN 'INPUT PURCHASED AND TRANSACTION HISTORY INTO POS MACHINE, RESPONSIBLE FOR CUSTOMER PAYMENT'
            WHEN POSITION='WAITRESS'
                THEN 'RESPONSIBLE FOR CUSTOMER SATISFACTION AND DOING TABLE AND CHAIR CLEAN UP' 
            WHEN POSITION='CHEF'
                THEN 'RESPONSIBLE WITH THE CUISINE AND RECIPE'
            WHEN POSITION='DISH WASHER'
                THEN 'CLEAN UP THE DISHES AND EATING FURNITURE USED BY THE CUSTOMER'
        END
    )
    VIRTUAL
);

--DROP SEQUENCE EMP_HR_SEQ;
CREATE SEQUENCE EMP_HR_SEQ
START WITH 4
INCREMENT BY 1
MAXVALUE 999
CYCLE;

ALTER TABLE EMP_HR MODIFY(ID DEFAULT EMP_HR_SEQ.NEXTVAL);

ALTER TABLE EMP_HR ADD SALARY NUMERIC NOT NULL;

ALTER TABLE EMP_HR MODIFY(JOB_DESC VARCHAR2(100) GENERATED ALWAYS AS(
        CASE POSITION
            WHEN 'MANAGER'
                THEN 'RESPONSIBLE WITH INTERNAL AND EXTERNAL BUSINESS, MANAGE THE RESTAURANT'
            WHEN 'CASHIER'
                THEN 'INPUT PURCHASED AND TRANSACTION HISTORY INTO POS MACHINE, RESPONSIBLE FOR CUSTOMER PAYMENT'
            WHEN 'WAITRESS'
                THEN 'RESPONSIBLE FOR CUSTOMER SATISFACTION AND DOING TABLE AND CHAIR CLEAN UP' 
            WHEN 'CHEF'
                THEN 'RESPONSIBLE WITH THE CUISINE AND RECIPE'
            WHEN 'DISH WASHER'
                THEN 'CLEAN UP THE DISHES AND EATING FURNITURE USED BY THE CUSTOMER'
            ELSE 'JOB DESCRIPTION IS UNKNOWN'
        END
    )
    VIRTUAL
);

--DROP TABLE EMP_HR;
INSERT INTO EMP_HR(NIK, NAME, POSITION,PHONE_NUMBER,ADDRESS,SALARY) VALUES('111111','WILLIAM SANJAYA','MANAGER','0111111111','ALAMAT WILLIAM',100000);
INSERT INTO EMP_HR(NIK, NAME, POSITION,PHONE_NUMBER,ADDRESS,SALARY) VALUES('222222','SANJAYA ANJAY','CASHIER','02222222222','ALAMAT SANJAYA',50000);
INSERT INTO EMP_HR(NIK, NAME, POSITION,PHONE_NUMBER,ADDRESS,SALARY) VALUES('333333','MIKHAEL SANSAN','CHEF','03333333333','ALAMAT MIKHAEL',60000);
COMMIT;

SELECT * FROM EMP_HR;

CREATE SEQUENCE REST_DETAIL_INFO_SEQ;
CREATE TABLE REST_DETAIL_INFO(
    ID NUMERIC DEFAULT REST_DETAIL_INFO_SEQ.NEXTVAL PRIMARY KEY,
    SECTOR_NAME VARCHAR2(25) UNIQUE NOT NULL,
    PIC_SECTOR NUMERIC NOT NULL,
    CONSTRAINT 
        FK_PIC_SECTOR FOREIGN KEY(PIC_SECTOR)
        REFERENCES EMP_HR (ID)
);
ALTER TABLE REST_DETAIL_INFO ADD SECTOR_DESC VARCHAR2(35);
ALTER TABLE REST_DETAIL_INFO DROP COLUMN PIC_SECTOR;

CREATE TABLE REST_MAST_INVENTORY(
    ID NUMERIC PRIMARY KEY,
    NAME VARCHAR(20) UNIQUE,
    QTY NUMERIC NOT NULL,
    INVT_DESC VARCHAR2(10) NOT NULL
);

CREATE SEQUENCE REST_MAST_INVENTORY_SEQ
START WITH 1
INCREMENT BY 1
MAXVALUE 999
CYCLE;

ALTER TABLE REST_MAST_INVENTORY MODIFY(ID DEFAULT REST_MAST_INVENTORY_SEQ.NEXTVAL);
ALTER TABLE REST_MAST_INVENTORY MODIFY INVT_DESC VARCHAR2(40);

CREATE SEQUENCE REST_DETAIL_INVENTORY_SEQ;
CREATE TABLE REST_DETAIL_INVENTORY(
    ID NUMERIC DEFAULT REST_DETAIL_INVENTORY_SEQ.NEXTVAL PRIMARY KEY,
    INVT_NAME VARCHAR2(20)UNIQUE,
    SECTOR_ID NUMERIC NOT NULL,
    STATUS VARCHAR2(20) NOT NULL,
    PURCHASED_AT DATE NOT NULL,
    PURCHASED_BY NUMERIC NOT NULL,
    INVT_DETAIL_DESC VARCHAR2(30),
    CONSTRAINT 
        FK_SECTOR_ID FOREIGN KEY(SECTOR_ID)
        REFERENCES REST_DETAIL_INFO (ID),
    CONSTRAINT 
        FK_PURCHASED_BY FOREIGN KEY(PURCHASED_BY)
        REFERENCES EMP_HR (ID)
);
ALTER TABLE REST_DETAIL_INVENTORY DROP COLUMN INVT_DETAIL_DESC;
ALTER TABLE REST_DETAIL_INVENTORY ADD MAST_INVT_ID NUMERIC;
ALTER TABLE REST_DETAIL_INVENTORY ADD CONSTRAINT FK_MAST_INVT_ID FOREIGN KEY(MAST_INVT_ID) REFERENCES REST_MAST_INVENTORY(ID);

CREATE TABLE FOOD_BEVERAGES_INFO(
    ID NUMERIC PRIMARY KEY,
    CATEGORY VARCHAR2(20) NOT NULL,
    NAME VARCHAR(20) UNIQUE,
    PRICE NUMERIC NOT NULL,
    STATUS VARCHAR2(10) NOT NULL
);

ALTER TABLE FOOD_BEVERAGES_INFO MODIFY PRICE DECIMAL;

ALTER TABLE FOOD_BEVERAGES_INFO DROP COLUMN STATUS;

ALTER TABLE FOOD_BEVERAGES_INFO ADD NOTES VARCHAR(30);

CREATE SEQUENCE FOOD_BEVERAGE_SEQ
START WITH 1
INCREMENT BY 1
MAXVALUE 999
CYCLE;

ALTER TABLE FOOD_BEVERAGES_INFO MODIFY(ID DEFAULT FOOD_BEVERAGE_SEQ.NEXTVAL);

CREATE SEQUENCE CUST_MAST_ORDER_SEQ;
CREATE TABLE CUST_MAST_ORDER(
    ORDER_ID NUMERIC DEFAULT CUST_MAST_ORDER_SEQ.NEXTVAL PRIMARY KEY,
    TABLE_ID NUMERIC,
    CUST_NAME VARCHAR2(30),
    ORDER_AT TIMESTAMP NOT NULL,
    ORDER_STATUS VARCHAR2(15) DEFAULT 'DINE-IN',
    PAYMENT_STATUS VARCHAR2(15)DEFAULT 'UNCOMPLETED',
    PURCHASED_AMOUNT DECIMAL NOT NULL,
    PB1_TAX DECIMAL GENERATED ALWAYS AS(PURCHASED_AMOUNT * 0.1) VIRTUAL,
    SERVICE_TAX DECIMAL GENERATED ALWAYS AS(PURCHASED_AMOUNT * 0.05) VIRTUAL,
    CONSTRAINT 
        FK_TABLE_ID FOREIGN KEY(TABLE_ID)
        REFERENCES REST_DETAIL_INVENTORY (ID)
);
ALTER TABLE CUST_MAST_ORDER RENAME COLUMN PURCHASED_AMOUNT TO TOTAL_ORDER;
ALTER TABLE CUST_MAST_ORDER DROP COLUMN PB1_TAX;
ALTER TABLE CUST_MAST_ORDER DROP COLUMN SERVICE_TAX;

CREATE SEQUENCE CUST_DETATIL_PAYMENT_SEQ;
CREATE TABLE CUST_DETATIL_PAYMENT(
    TRANSACTION_ID NUMERIC DEFAULT CUST_DETATIL_PAYMENT_SEQ.NEXTVAL PRIMARY KEY,
    PIC_CASHIER NUMERIC NOT NULL,
    PAYMENT_METHOD VARCHAR(20) DEFAULT 'CASH',
    DISC DECIMAL DEFAULT 0,
    TOTAL_PURCHASED DECIMAL NOT NULL,
    PAID_AMOUNT DECIMAL,
    TOTAL_MONEY_RETURN DECIMAL,
    PAID_ON TIMESTAMP,
    CONSTRAINT 
        DISC_CK CHECK (DISC<TOTAL_PURCHASED),
    CONSTRAINT 
        FK_PIC_CASHIER FOREIGN KEY(PIC_CASHIER) 
        REFERENCES EMP_HR (ID)
);
ALTER TABLE CUST_DETATIL_PAYMENT DROP CONSTRAINT DISC_CK;
RENAME CUST_DETATIL_PAYMENT TO CUST_DETAIL_PAYMENT;

CREATE TABLE CUST_ORDER_PAYMENT(
    ID NUMERIC DEFAULT CUST_ORDER_PAYMENT_SEQ.NEXTVAL PRIMARY KEY,
    TRANSACTION_ID NOT NULL,
    ORDER_ID NOT NULL,
    CONSTRAINT 
        FK_TRANSACTION_ID FOREIGN KEY(TRANSACTION_ID)
        REFERENCES CUST_DETATIL_PAYMENT (TRANSACTION_ID),
    CONSTRAINT 
        FK_ORDER_ID FOREIGN KEY(ORDER_ID)
        REFERENCES CUST_MAST_ORDER (ORDER_ID)
);
ALTER TABLE CUST_ORDER_PAYMENT ADD PAID_ON TIMESTAMP;

CREATE SEQUENCE CUST_DETAIL_ORDER_SEQ;
CREATE TABLE CUST_DETAIL_ORDER(
    DETAIL_ID NUMERIC DEFAULT CUST_DETAIL_ORDER_SEQ.NEXTVAL PRIMARY KEY,
    MAST_ORDER_ID NUMERIC NOT NULL,
    FOOD_ID NUMERIC NOT NULL,
    QTY NUMERIC NOT NULL,
    SUBTOTAL DECIMAL NOT NULL,
    NOTES VARCHAR2(30),
    CONSTRAINT 
        FK_MAST_ORDER_ID FOREIGN KEY(MAST_ORDER_ID)
        REFERENCES CUST_MAST_ORDER (ORDER_ID),
    CONSTRAINT 
        FK_FOOD_ID FOREIGN KEY(FOOD_ID)
        REFERENCES FOOD_BEVERAGES_INFO (ID)
);

CREATE SEQUENCE CASHIER_POS_RECORD_SEQ;
CREATE TABLE CASHIER_POS_RECORD (
    ID NUMERIC DEFAULT CASHIER_POS_RECORD_SEQ.NEXTVAL PRIMARY KEY,
    CASHIER_ID NUMERIC NOT NULL,
    POS_ID NUMERIC NOT NULL,
    SIGN_IN_OFFICE TIMESTAMP,
    SIGN_OUT_OFFICE TIMESTAMP,
    INPUT_DATE DATE,
    NOTES VARCHAR2(35),
    CONSTRAINT
        FK_CASHIER_ID FOREIGN KEY(CASHIER_ID)
        REFERENCES EMP_HR(ID),
    CONSTRAINT
        FK_POS_ID FOREIGN KEY(POS_ID)
        REFERENCES REST_DETAIL_INVENTORY(ID)
);
ALTER TABLE CASHIER_POS_RECORD DROP COLUMN NOTES;

ALTER TABLE CASHIER_POS_RECORD ADD CONSTRAINT SIGN_OUT_OFFICE_CK CHECK (SIGN_OUT_OFFICE>SIGN_IN_OFFICE);

CREATE INDEX FOOD_BEVERAGES_CATEGORY_I ON FOOD_BEVERAGES_INFO(CATEGORY);

CREATE INDEX CUST_MAST_ORDER_PAYMENT_STATUS_I ON CUST_MAST_ORDER(PAYMENT_STATUS);
